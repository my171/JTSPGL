<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>集团仓库管理系统 - 优化版</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f5f7fa;
        font-family: "Segoe UI", sans-serif;
        overflow: hidden;
      }
            .map-area {
        flex: 1;
        background-color: #e6ecf2; /* 如果图片加载失败，则显示这个背景色 */
        border: 1px solid #ccc;
        border-radius: 10px;
        position: relative;
        margin-bottom: 15px;
        background-image: url('map.png'); /*新增背景图片 */
        background-size: cover; /* 使背景图片覆盖整个区域 */
        background-repeat: no-repeat;
        background-position: center;
        }
      
      .input-group .btn:hover {
        background-color: #3a76d8;
      }
      .left-panel {
        height: 100vh;
        padding: 20px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .right-panel {
        height: 100vh;
        background-color: #ffffff;
        border-left: 1px solid #ddd;
        padding: 20px;
        overflow-y: auto;
        transition: transform 0.3s ease-in-out;
      }
      .header-time {
        font-size: 28px;
        font-weight: bold;
        color: #333;
        text-align: center;
        margin-bottom: 10px;
      }
      .map-area {
        flex: 1;
        background-color: #e6ecf2;
        border: 1px solid #ccc;
        border-radius: 10px;
        position: relative;
        margin-bottom: 15px;
      }
      .warehouse {
        position: absolute;
        cursor: pointer;
        transition: transform 0.2s, background-color 0.2s;
        padding: 6px 12px;
        border-radius: 8px;
        background-color: #5baaff;
        color: white;
        font-size: 14px;
      }
      .warehouse:hover {
        background-color: #0077f7;
        transform: scale(1.05);
      }
      .chat-box {
        background-color: #fff;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        height: 230px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        position: relative;
        z-index: 0;
      }
      .chat-history {
        flex: 1;
        overflow-y: auto;
        margin-bottom: 8px;
        padding-right: 5px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .chat-message-row {
        display: flex;
        flex-direction: row;
      }
      .chat-message {
        background-color: #e0f0ff;
        padding: 8px 12px;
        border-radius: 10px;
        max-width: 80%;
        word-break: break-word;
      }
      .popup-panel {
        position: fixed;
        top: 0;
        right: 0;
        width: 400px;
        height: 100vh;
        background: #fff;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        overflow-y: auto;
        z-index: 9999;
        transform: translateX(100%);
        transition: transform 0.3s ease-in-out;
      }
      .popup-panel.show {
        transform: translateX(0);
      }
      .store-button,
      .action-button,
      .approval-button {
        display: inline-block;
        padding: 6px 12px;
        margin: 5px;
        border-radius: 8px;
        cursor: pointer;
        border: none;
        font-size: 14px;
        transition: 0.2s;
      }
      .store-button {
        background-color: #f8f9fa;
        border: 1px solid #ccc;
      }
      .store-button:hover {
        background-color: #e2e6ea;
      }
      .approval-button {
        width: 100%;
        text-align: left;
      }
      .status-gray {
        background-color: #e0e0e0;
        color: #333;
        border: 1px solid #bcbbbb;
        transition: transform 0.1s ease;
      }
      .status-gray:hover {
        background-color: #bcbbbb;
        color: #333;
        transform: scale(1.02);
      }
      .status-red {
        background-color: #f8d7da;
        color: #842029;
        border: 1px solid #f8c4c9;
        transition: transform 0.1s ease;
      }
      .status-red:hover {
        background-color: #f8c4c9;
        color: #842029;
        transform: scale(1.02);
      }
      .status-blue {
        background-color: #dbe9f5;
        color: #0d6efd;
        border: 1px solid #c0dbf3;
        transition: transform 0.1s ease;
      }
      .status-blue:hover {
        background-color: #c0dbf3;
        color: #0d6efd;
        transform: scale(1.02);
      }
      .status-yellow {
        background-color: #fff3cd;
        color: #664d03;
        border: 1px solid #f8e6a8;
        transition: transform 0.1s ease;
      }
      .status-yellow:hover {
        background-color: #f8e6a8;
        color: #664d03;
        transform: scale(1.02);
      }
      .status-orange {
        background-color: #ffe5b4;
        color: #a75d00;
        border: 1px solid #ffd1a1;
        transition: transform 0.1s ease;
      }
      .status-orange:hover {
        background-color: #ffd1a1;
        color: #a75d00;
        transform: scale(1.02);
      }
      .status-green {
        background-color: #d1e7dd;
        color: #0f5132;
        border: 1px solid #b6e9d2;
        transition: transform 0.1s ease;
      }
      .status-green:hover {
        background-color: #b4e3ce;
        color: #0f5132;
        transform: scale(1.02);
      }
      .query-options {
        margin-top: 15px;
      }
      .btn-group-sm button {
        font-size: 13px;
      }
      .input-group .btn {
        z-index: 1;
      }

      /* 新增的圆角输入区域样式 */
      .chat-input-area {
        display: flex;
        gap: 8px;
      }

      .input-group {
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid #ced4da;
      }

      .input-group .form-control {
        border: none;
        border-radius: 10px;
        padding: 10px 15px;
      }

      .input-group .form-control:focus {
        box-shadow: none;
        outline: none;
      }

      .input-group .btn {
        border-radius: 8px;
        padding: 10px 20px;
        background-color: #4a86e8;
        color: white;
        border: none;
        transition: background-color 0.3s;
      }



      /* 美化聊天历史区域 */
      .chat-history {
        padding: 10px;
        background-color: #f9f9f9;
        border-radius: 8px;
      }

      .chat-message-row.receiver {
        justify-content: flex-start;
      }

      .chat-message-row.sender {
        justify-content: flex-end;
      }

      .receiver .chat-message {
        background-color: #e0f0ff;
        border-top-left-radius: 0;
      }

      .sender .chat-message {
        background-color: #d1e7dd;
        border-top-right-radius: 0;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-9 left-panel">
          <div>
            <div class="header-time" id="current-time">北京时间：</div>
            <div class="map-area">
              <div
                class="warehouse"
                style="top: 80px; left: 100px"
                onclick="showWarehouseInfo('WH001', '华北中心仓')"
              >
                华北中心仓
              </div>
              <div
                class="warehouse"
                style="top: 120px; left: 280px"
                onclick="showWarehouseInfo('WH002', '华东智能仓')"
              >
                华东智能仓
              </div>
              <div
                class="warehouse"
                style="top: 220px; left: 160px"
                onclick="showWarehouseInfo('WH003', '华南枢纽仓')"
              >
                华南枢纽仓
              </div>
              <div
                class="warehouse"
                style="top: 300px; left: 80px"
                onclick="showWarehouseInfo('WH004', '西南分拨中心')"
              >
                西南分拨中心
              </div>
              <div
                class="warehouse"
                style="top: 350px; left: 260px"
                onclick="showWarehouseInfo('WH005', '东北冷链仓')"
              >
                东北冷链仓
              </div>
            </div>
          </div>
          <div class="chat-box">
            <div class="chat-history" id="chat-history"></div>
            <div class="chat-input-area">
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="chat-input"
                  placeholder="请输入您的问题..."
                />
                <button class="btn btn-dark" onclick="sendMessage()">
                  发送
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3 right-panel" id="right-panel">
          <h5>AI 实时预警</h5>
          <textarea class="form-control mb-3" rows="3" readonly>
暂无预警</textarea
          >

          <h5 class="mt-4">审批流进度</h5>
          <div id="approval-status">
            <button
              class="approval-button status-green"
              onclick="showApprovalDetail('P10006')"
            >
              商品 P10006 - 已完成
            </button>
            <button
              class="approval-button status-orange"
              onclick="showApprovalDetail('P10005')"
            >
              商品 P10005 - 待收货
            </button>
            <button
              class="approval-button status-yellow"
              onclick="showApprovalDetail('P10004')"
            >
              商品 P10004 - 发货中
            </button>
            <button
              class="approval-button status-blue"
              onclick="showApprovalDetail('P10003')"
            >
              商品 P10003 - 待出库
            </button>
            <button
              class="approval-button status-red"
              onclick="showApprovalDetail('P10002')"
            >
              商品 P10002 - 审核不通过
            </button>
            <button
              class="approval-button status-gray"
              onclick="showApprovalDetail('P10001')"
            >
              商品 P10001 - 待审核
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="popup-panel" id="popup-panel">
      <button
        class="btn btn-sm btn-outline-secondary mb-3"
        onclick="closePopup()"
      >
        关闭
      </button>
      <div id="popup-content">加载中...</div>
    </div>
    <script>
      function updateTime() {
        const now = new Date();
        document.getElementById("current-time").innerText =
          "北京时间：" + now.toLocaleString();
      }
      setInterval(updateTime, 1000);
      updateTime();
      function showWarehouseInfo(id, name) {
        document.getElementById("right-panel").style.transform =
          "translateX(-400px)";
        const stores = {
          WH001: ["北京王府井旗舰店", "武汉武商广场店"],
          WH002: ["上海徐家汇店", "南京新街口店", "杭州西湖店"],
          WH003: ["广州天河城店", "深圳万象城店"],
          WH004: ["成都春熙路店", "重庆解放碑店"],
          WH005: ["西安钟楼店"],
        };
        let html = `<h5>${name} - 商店列表</h5>`;
        stores[id].forEach((store) => {
          html += `<button class='store-button' onclick="showStoreOptions('${store}')">${store}</button>`;
        });
        showPopup(html);
      }

      function showStoreOptions(store) {
        let html = `<h5>${store} - 操作选项</h5>
      <div class='query-options'>
        <div class="input-group mb-3">
          <input class="form-control" placeholder="输入商品编号或名称">
          <button class="btn btn-primary">查询</button>
        </div>
        <div class="input-group">
          <input class="form-control" placeholder="输入商品编号或名称">
          <button class="btn btn-success">调货</button>
        </div>
      </div>`;
        showPopup(html);
      }

      function showPopup(html) {
        document.getElementById("popup-content").innerHTML = html;
        document.getElementById("popup-panel").classList.add("show");
      }

      function closePopup() {
        document.getElementById("popup-panel").classList.remove("show");
        document.getElementById("right-panel").style.transform =
          "translateX(0)";
      }

      function sendMessage() {
        const input = document.getElementById("chat-input");
        const history = document.getElementById("chat-history");
        if (input.value.trim()) {
          const row = document.createElement("div");
          row.className = "chat-message-row sender";

          const msg = document.createElement("div");
          msg.className = "chat-message";
          msg.textContent = input.value;

          row.appendChild(msg);
          history.appendChild(row);

          // 添加模拟回复
          setTimeout(() => {
            const botRow = document.createElement("div");
            botRow.className = "chat-message-row receiver";

            const botMsg = document.createElement("div");
            botMsg.className = "chat-message";
            botMsg.textContent = "已收到您的消息：" + input.value;

            botRow.appendChild(botMsg);
            history.appendChild(botRow);

            history.scrollTop = history.scrollHeight;
          }, 500);

          history.scrollTop = history.scrollHeight;
          input.value = "";
        }
      }

      function showApprovalDetail(productId) {
        document.getElementById("right-panel").style.transform =
          "translateX(-400px)";
        const infoMap = {
          P10001: {
            status: "待审核",
            decisionTime: "-",
            reviewTime: "-",
            dispatchTime: "-",
            receivedTime: "-",
            from: "华东智能仓",
            to: "南京新街口店",
          },
          P10006: {
            status: "已完成",
            decisionTime: "2025-07-01 10:00",
            reviewTime: "2025-07-02 11:00",
            dispatchTime: "2025-07-03 15:30",
            receivedTime: "2025-07-05 09:15",
            from: "华北中心仓",
            to: "北京王府井旗舰店",
          },
          P10002: {
            status: "审核不通过",
            decisionTime: "2025-06-28 14:00",
            reviewTime: "2025-06-29 09:30",
            dispatchTime: "-",
            receivedTime: "-",
            from: "华南枢纽仓",
            to: "广州天河城店",
          },
          P10003: {
            status: "待出库",
            decisionTime: "2025-06-30 08:00",
            reviewTime: "-",
            dispatchTime: "-",
            receivedTime: "-",
            from: "西南分拨中心",
            to: "成都春熙路店",
          },
          P10004: {
            status: "发货中",
            decisionTime: "2025-07-01 12:00",
            reviewTime: "2025-07-01 13:30",
            dispatchTime: "2025-07-02 10:00",
            receivedTime: "-",
            from: "东北冷链仓",
            to: "西安钟楼店",
          },
          P10005: {
            status: "待收货",
            decisionTime: "2025-07-02 16:00",
            reviewTime: "2025-07-03 09:00",
            dispatchTime: "2025-07-04 14:30",
            receivedTime: "-",
            from: "华东智能仓",
            to: "上海徐家汇店",
          },
        };

        const item = infoMap[productId] || {
          status: "未知",
          decisionTime: "-",
          reviewTime: "-",
          dispatchTime: "-",
          receivedTime: "-",
          from: "-",
          to: "-",
        };
        const html = `
      <h5>审批详情：${productId}</h5>
      <p><strong>当前状态：</strong>${item.status}</p>
      <p><strong>调出仓库：</strong>${item.from}</p>
      <p><strong>调入商店：</strong>${item.to}</p>
      <p><strong>决策时间：</strong>${item.decisionTime}</p>
      <p><strong>审核时间：</strong>${item.reviewTime}</p>
      <p><strong>发货时间：</strong>${item.dispatchTime}</p>
      <p><strong>收货时间：</strong>${item.receivedTime}</p>
    `;
        showPopup(html);
      }
    </script>
  </body>
</html>
